<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Disaster Management System</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* Loader Styles */
    #loader {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100vw;
      background: rgba(255, 255, 255, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #loader svg {
      width: 150px;
      height: 120px;
    }

    #loader polyline {
      fill: none;
      stroke-width: 15; /* Thick stroke */
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    #loader polyline#back {
      stroke: #ff4d5033;
    }

    #loader polyline#front {
      stroke: #ff4d4f;
      stroke-dasharray: 100, 300;
      stroke-dashoffset: 400;
      animation: dash_682 1.4s linear infinite;
    }

    @keyframes dash_682 {
      72.5% {
        opacity: 0;
      }
      to {
        stroke-dashoffset: 0;
      }
    }
  </style>
</head>
<body>

<!-- Loader -->
<div id="loader" class="loading">
  <svg viewBox="0 0 512 512">
    <polyline id="back" points="20,250 150,250 200,150 300,350 370,250 480,250"></polyline>
    <polyline id="front" points="20,250 150,250 200,150 300,350 370,250 480,250"></polyline>
  </svg>
</div>

<div class="container">
  <h1>Disaster Management System</h1>

  <!-- Flash messages (hidden divs, handled by JS to show alert) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash" data-category="{{ category }}" style="display:none;">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Form to add zone and priority -->
  <form method="POST" action="/submit" class="zone-form">
    <input type="text" id="zone" name="zone" placeholder="Enter Zone Name" required>
    <input type="number" id="priority" name="priority" min="1" max="10" placeholder="Priority (1-10)" required>
    <button type="submit">Add Zone</button>
  </form>

  <h2>Zones, Priorities and Resources</h2>

  <div class="card-container">
    {% if zones %}
      {% for zone, priority, resources in zones %}
      <div class="card">
        <div class="card-title">{{ zone }}</div>
        <div class="card-priority">Priority: {{ priority }}</div>
        <div class="card-resources">Resources: {{ resources }}</div>
        <form method="POST" action="/delete" style="margin-top: 10px;">
          <input type="hidden" name="zone" value="{{ zone }}">
          <button type="submit" class="delete-button">Delete</button>
        </form>
      </div>
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <h2>No Zones Added Yet!</h2>
      </div>
    {% endif %}
  </div>
  
</div>

<!-- Scripts -->
<script>
    function showLoader() {
      const loader = document.getElementById('loader');
      loader.style.display = 'flex';
      setTimeout(() => {
        loader.style.opacity = '1';
      }, 10); // tiny delay for smooth fade-in
    }
  
    function hideLoader() {
      const loader = document.getElementById('loader');
      loader.style.opacity = '0';
      setTimeout(() => {
        loader.style.display = 'none';
      }, 500); // match fade-out transition
    }
  
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
      form.addEventListener('submit', function (e) {
        e.preventDefault(); // Pause actual form submission
        showLoader(); // Show loader
        setTimeout(() => {
          form.submit(); // Submit after 2 seconds
        }, 2000);
      });
    });
  
    // ðŸŽ¯ Show SweetAlert2 popups on page load if any flash messages exist
    window.addEventListener('load', () => {
      hideLoader(); // Hide loader immediately after page loads
      const flashes = document.querySelectorAll('.flash');
      flashes.forEach(flash => {
        if (flash.textContent.trim()) {
          let iconType = 'success'; // Default icon
  
          // Dynamically set icon based on message content
          const message = flash.textContent.trim().toLowerCase();
          if (message.includes('already exists') || message.includes('error') || message.includes('failed')) {
            iconType = 'error';
          }
  
          Swal.fire({
            title: 'Notification',
            text: flash.textContent.trim(),
            icon: iconType,
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'OK'
          });
        }
      });
    });
  </script>
</body>
</html>
